#!/bin/sh
cd ${0%/*} || exit 1    # Run from this directory

# Source tutorial run functions
. $WM_PROJECT_DIR/bin/tools/RunFunctions

# ========================================================
# 1. Vérification et Nettoyage
# ========================================================
echo "-----------------------------------"
echo "Nettoyage rapide..."
./Allclean
rm -rf constant/polyMesh constant/air constant/solid
rm -rf system/domain* constant/domain* 0/domain* # Au cas où

if [ ! -f "constant/triSurface/sphere.stl" ]; then
    echo "ERREUR : Fichiers STL manquants dans constant/triSurface/"
    exit 1
fi

# ========================================================
# 2. Maillage
# ========================================================
echo "-----------------------------------"
echo "Maillage (blockMesh + snappy)..."

runApplication blockMesh
runApplication snappyHexMesh -overwrite

# ========================================================
# 3. Séparation des Régions
# ========================================================
echo "-----------------------------------"
echo "Séparation des domaines..."


runApplication splitMeshRegions -cellZones -overwrite

# === AJOUT ===
echo "Copie des propriétés thermiques du solide..."
cp constant/thermophysicalProperties.solid constant/solid/thermophysicalProperties
cp constant/thermophysicalProperties.air constant/air/thermophysicalProperties

# =============

# ========================================================
# 4. Simulation 
# ========================================================
echo "-----------------------------------"
echo "Lancement du calcul..."

# Plus de decomposePar !
# Plus de mpirun !
# Juste le solveur direct :
runApplication chtMultiRegionFoam

# ========================================================
# 5. Fin
# ========================================================
# Plus de reconstructPar non plus ! Les résultats sont directement là.
echo "-----------------------------------"
echo "Terminé."
